image: alpine:3.7

stages:
  - test
  - deploy

test:
  image: koalaman/shellcheck-alpine:stable
  stage: test
  before_script:
    - apk add --no-cache bash curl
  script:
    - mkdir -p binaries
    - curl -o binaries/bash_script_test_standalone.sh -L https://singletonsd.gitlab.io/scripts/common/latest/bash_script_test_standalone.sh
    - chmod +x binaries/bash_script_test_standalone.sh
    - ./binaries/bash_script_test_standalone.sh

pages:
  stage: deploy
  before_script:
    - if [ "${CI_COMMIT_REF_NAME}" == "master" ]; then
        export TARGET_FOLDER=public/latest;
      else
        export TARGET_FOLDER=public/${CI_COMMIT_REF_NAME};
      fi
    - apk add --no-cache bash curl zip
  script:
    - mkdir -p binaries
    - curl -o binaries/zip_files.sh -L https://singletonsd.gitlab.io/scripts/common/latest/zip_files.sh
    - chmod +x binaries/zip_files.sh
    - ./binaries/zip_files.sh
    - rm -rf "${TARGET_FOLDER}"
    - mkdir -p "${TARGET_FOLDER}"
    - cp -r src/* "${TARGET_FOLDER}"
    - ./binaries/zip_files.sh
  artifacts:
    paths:
      - public